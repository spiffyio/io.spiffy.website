var Config,Keys,Width;Config={cdn:"//cdn.spiffy.io/static"},Keys={left:37,right:39},Width={xs:320,sm:480,md:768,lg:992,xl:1200};var blank,confirmation,contains,defined,go,handler,high,initModalSize,medium,overrideHandler,preventDefault,quality,refresh;preventDefault=function(e){e.preventDefault()},overrideHandler=refresh,handler=function(e){return defined(e)&&(overrideHandler=e),defined(overrideHandler)?overrideHandler:refresh},medium=function(e){quality(e,"m",["a","l"],function(){high(e)})},high=function(e){quality(e,"h",["a","l","m"])},quality=function(e,t,a,n){var i,o,s,d,r;for(null==a&&(a=["a","l","m","h"]),r=e.attr("src"),i=0,s=a.length;s>i;i++)d=a[i],r=r.replace("q="+d,"q="+t);o=new Image,o.onload(function(){e.remove("lazy").attr("src",r),null!=n&&n()}),o.src=r},confirmation=function(e,t){var a;a=$("#confirmation"),a.find(".modal-title").text(e),a.find(".continue").on("click",function(e){return e.preventDefault(),t()}),a.modal("show")},go=function(e){return location.href=e},refresh=function(){return location.reload(!0),window.location=self.location},blank=function(e){return defined(e)?""===e:!0},defined=function(e){return"undefined"==typeof e?!1:"undefined"!==e},contains=function(e,t){var a;return a=e.indexOf(t),a>-1},initModalSize=function(){var e;return e=$(window).height()-125+"px",$(".modal-body").css("max-height",e),e};var Spiffy,base,base1,base2,base3,base4,base5;null==(base=Array.prototype).isArray&&(base.isArray=function(){return"[object Array]"==={}.toString.call(value)}),null==(base1=String.prototype).startsWith&&(base1.startsWith=function(e){return this.slice(0,e.length)===e}),null==(base2=String.prototype).endsWith&&(base2.endsWith=function(e){return""===e||this.slice(-e.length)===e}),null==(base3=String.prototype).contains&&(base3.contains=function(e){return""===e||this.indexOf(e)>-1}),null==(base4=String.prototype).containsIgnoreCase&&(base4.containsIgnoreCase=function(e){return""===e||this.toUpperCase().indexOf(e.toUpperCase())>-1}),null==(base5=String.prototype).equalsIgnoreCase&&(base5.equalsIgnoreCase=function(e){return this.toUpperCase()===e.toUpperCase()}),Spiffy={firstDefined:function(){var e,t,a;for(a=arguments.length-1;a>=0;a+=-1)e=arguments[a],null!=e&&(t=e);return null!=t?t:void 0}},jQuery.fn.spiffy=function(){var e,t;return e=$(this),t={end:function(){return e},disable:function(){return e.find("form, input, textarea, select, button, div.g-recaptcha").addBack().not('[data-disabled="permanent"]').prop("disabled",!0).attr("data-disabled",!0).addClass("disabled").data("disabled",!0),e.spiffy()},enable:function(){return e.find("form, input, textarea, select, button, div.g-recaptcha").addBack().not('[data-disabled="permanent"]').removeAttr("disabled").removeAttr("data-disabled").removeClass("disabled").data("disabled",!1),e.spiffy()},clear:function(){return e.find("input, textarea").val(""),e.spiffy()},push:function(t){var a,n,i;return a=$(e[0]),n=a.attr("name"),i=a.val(),null==t[n]?t[n]=i:t[n]=t[n]+","+i,t},data:function(){var t,a,n,i;if(e.length>1){for(t=[],n=0,i=e.length;i>n;n++)a=e[n],t.push($(a).spiffy().data());return t}return a=$(e[0]),a.is("form")?(t={},a.find("[name]").each(function(){return $(this).spiffy().push(t)}),$('[data-form-name="'+a.data("name")+'"]').each(function(){return $(this).spiffy().push(t)}),t):t=a.val()},loading:function(t,a,n){var i,o,s,d;return null==a&&(a=!0),null==n&&(n=2e3),o=$(e[0]),o.is("form")?("overlay".equalsIgnoreCase(t)?(s=o.find("img.loading"),!a||null!=s&&s.is("img.loading")||(o.css("position","relative"),s=$(document.createElement("img")),s.addClass("loading"),s.attr("src","https://cdn.spiffy.io/static/svg/loading.svg"),s.prop("hidden"),o.append(s)),a&&null!=s&&s.is("img.loading")&&s.slideDown(),!a&&null!=s&&s.is("img.loading")&&s.slideUp()):"header".equalsIgnoreCase(t)&&(s=$("img.header-logo"),null!=s&&s.is("img.header-logo")&&(d=s.attr("src"),d=a?d.replace("icon","loading"):d.replace("loading","icon"),s.attr("src",d)),i=$("div.header-loading"),null!=i&&i.is("div.header-loading")&&(a?i.animate({width:"80%"},n):i.finish().animate({width:"100%"},250,"swing",function(){return i.animate({opacity:"0"},500,"swing",function(){return i.css("width","0%"),i.css("opacity","1")})}))),o.spiffy()):void 0},options:function(t){var a;return a=$(e[0]),a.is("form")?null!=t?(a.data("options",$.extend(a.data("options"),t)),a.spiffy()):a.data("options"):void 0},submit:function(t){var a,n,i,o,s,d,r,l;return s=$(e[0]),s.is("form")&&!s.data("disabled")?(t=Spiffy.firstDefined(t,$(s).spiffy().options(),{}),l=Spiffy.firstDefined(t.url,s.data("url"),s.attr("action")),r=Spiffy.firstDefined(t.type,s.data("type"),s.attr("method"),"POST"),a=s.data("csrf-token"),null==a&&r.equalsIgnoreCase("POST")&&alert("csrf required"),i=Spiffy.firstDefined(t.disable,!0),i&&s.spiffy().disable(),d=Spiffy.firstDefined(t.loading,s.data("loading"),"overlay"),s.spiffy().loading(d),o=s.find("div.message"),null!=o&&o.is("div.message")&&o.slideUp(),n=s.spiffy().data(),$.ajax({url:l,data:n,dataType:"json",headers:{"X-CSRF-Token":a},type:r,success:function(e,a,n){return s.spiffy().enable().loading(d,!1),null!=t.success?t.success(s,e,a,n):void 0},error:function(e,a,n){var i,r,l,u;return l=e.responseJSON,401===e.status&&null!=l.uri?void go(e.responseJSON.uri):(400===e.status&&null!=l.error&&(i=s.find('input[name="'+l.error+'"]'),null!=i&&i.is('input[name="'+l.error+'"]')?(o=i.parent(),u=o.find("span"),o.addClass("bt-flabels__error"),u.html(l.reason)):(o=s.find("div.message"),o.addClass("error"),o.html(l.reason),o.slideDown())),null!=l.tip&&(o=s.find("div.message"),o.addClass("tip"),o.html(l.tip),o.slideDown()),r=s.find(".g-recaptcha"),null!=r&&r.is(".g-recaptcha")&&grecaptcha.reset(),s.spiffy().enable().loading(d,!1),null!=t.error?t.error(s,e,a,n):void 0)}}),s.spiffy()):void 0}}};var addedfile,adjustColumns,closeModal,emptyColumn,fillColumn,fingerprint,load,loadPosts,openModal,sortColumn;addedfile=function(e){var t,a,n,i,o,s,d,r,l,u;return null==e.accepted?(n=function(){addedfile(e)},void setTimeout(n,10)):e.accepted?($("#dz-form").hide(),a=$("form.submit"),s=a.find("div.preview"),t=$(document.createElement("div")),l=URL.createObjectURL(e),a.attr("data-media-src",l),a.attr("data-media-type",e.type),e.type.containsIgnoreCase("video")?(a.spiffy().loading("header",!0,3e4),t.addClass("video"),t.addClass("paused"),u=$(document.createElement("video")),u.attr("autoplay",!0),u.attr("muted",!0),u.attr("loop",!0),u.attr("preload","auto"),u.attr("poster","/static/png/processing.png"),r=$(document.createElement("source")),r.attr("type",e.type),r.attr("src",l),u.append(r),d=$(document.createElement("img")),d.attr("src","/static/png/processing.png"),u.append(d),t.append(u)):e.type.containsIgnoreCase("image")?(a.spiffy().loading("header",!0,5e3),i=$(document.createElement("img")),i.attr("src",l),t.append(i)):(a.spiffy().loading("header",!0,5e3),i=$(document.createElement("img")),i.attr("src","/static/png/processing.png"),t.append(i)),s.prepend(t),void a.slideDown()):(a=$("#dz-form"),o=a.find(".message"),o.html("unable to upload file: "+e.name),o.slideDown(),void a.animate({height:"10em"},500))},Dropzone.options.dzForm={paramName:"file",maxFiles:1,maxFilesize:200,uploadMultiple:!1,createImageThumbnails:!1,autoProcessQueue:!0,accept:function(e,t){var a;a=e.type,a.equalsIgnoreCase("image/gif")?t():a.equalsIgnoreCase("image/jpg")?t():a.equalsIgnoreCase("image/jpeg")?t():a.equalsIgnoreCase("image/png")?t():a.equalsIgnoreCase("video/mov")?t():a.equalsIgnoreCase("video/mp4")?t():a.equalsIgnoreCase("video/mpeg4")?t():a.equalsIgnoreCase("video/quicktime")?t():a.equalsIgnoreCase("video/webm")?t():t("unable to upload file: "+e.name)},init:function(){return this.on("addedfile",function(e){addedfile(e)}),this.on("uploadprogress",function(){})},success:function(e,t){var a,n;a=$("form.submit"),a.spiffy().enable().loading("header",!1),n=a.find('input[name="media"]'),n.val(t.name)}},$(document).ready(function(){var e;$("div.header").mouseenter(function(){$(this).is(":hover")&&$(this).removeClass("hidden")}),$("div.header").mouseleave(function(){var e,t;t=$(this),e=function(){!t.is(":hover")&&$(window).scrollTop()>400&&(t.addClass("hidden"),t.find(".sub-menu").removeClass("show"))},setTimeout(e,500)}),$(".menu-toggle").click(function(){var e,t;t=$(this),e=t.parent().find(".sub-menu"),e.toggleClass("show")}),$("[data-modal]").click(function(){openModal($(this).data("modal"))}),$("[data-uri]").click(function(){go($(this).data("uri"))}),$('input[name="fingerprint"]')&&(e=fingerprint(),null!=e&&$('input[name="fingerprint"]').each(function(){$(this).val(e)})),$("[data-unprocessed]").each(function(){var e,t,a,n,i,o,s,d;e=$(this),a=e.data("unprocessed"),o=sessionStorage.getItem("src:"+a),s=sessionStorage.getItem("type:"+a),null!=o&&null!=s&&(s.containsIgnoreCase("video")?(e.addClass("video"),e.addClass("paused"),d=$(document.createElement("video")),d.attr("autoplay",!0),d.attr("muted",!0),d.attr("loop",!0),d.attr("preload","auto"),d.attr("poster","/static/png/processing.png"),i=$(document.createElement("source")),i.attr("type",s),i.attr("src",o),d.append(i),n=$(document.createElement("img")),n.attr("src","/static/png/processing.png"),d.append(n),e.html(d)):s.containsIgnoreCase("image")&&(t=$(document.createElement("img")),t.attr("src",o),e.html(t)))}),$("form:not(#dz-form)").submit(function(e){var t;preventDefault(e),t=$(this),t.spiffy().submit()}),$("form.load-posts").spiffy().options({success:function(e,t){return null==t.posts?e.spiffy().disable():load(t)}}),$("form.forgot").spiffy().options({success:function(e){var t;e.spiffy().disable(),t=e.find("div.message"),t.addClass("success"),t.html("recovery email sent"),t.slideDown()}}),$("form[data-return-uri]").spiffy().options({success:function(e){return go(e.data("return-uri"))}}),$("form.comment").spiffy().options({success:function(){return refresh()}}),$("form.submit").spiffy().options({success:function(e,t){return sessionStorage.setItem("src:"+t.name,e.data("media-src")),sessionStorage.setItem("type:"+t.name,e.data("media-type")),go("/stream/"+t.name)}}),$("a[data-form]").click(function(e){var t;preventDefault(e),t=$("form."+$(this).data("form")),t.submit()}),$("a[data-session-id]").click(function(e){var t;preventDefault(e),t=$("form.logout"),t.find('input[name="session"]').val($(this).data("session-id")),t.submit()}),$("form.logout").spiffy().options({success:function(e){var t,a,n;a=e.find('input[name="session"]'),n=a.val(),t=$('[data-session-id="'+n+'"]'),t.parent().parent().slideUp()}}),$("form.delete").spiffy().options({success:function(){refresh()}}),$("form.action").spiffy().options({success:function(){go("/")}}),$("div.actions").find("button").each(function(){var e,t;e=$(this),t=e.parents("div.actions:first").find("form"),e.click(function(){var a,n;n=t.find('input[name="action"]'),a=e.data("action"),n.val(a),t.submit()})}),$(".close").click(function(){closeModal()}),$(".modal-overlay").click(function(e){$(e.target).hasClass("modal-overlay")&&closeModal()}),$('video[data-autoplay="true"]').each(function(){var e;e=$(this),e.is(":in-viewport")&&e.is(":in-viewport("+(e[0].getBoundingClientRect().bottom-e[0].getBoundingClientRect().top)+")")?e[0].paused&&(e[0].play(),e.parents("div.video:first").removeClass("paused")):e[0].paused||(e[0].pause(),e.parents("div.video:first").addClass("paused"))}),$(document).on("click",".thismedia",function(){var e,t,a;t=$(this),t.toggleClass("clicked"),e=$("form.delete"),$("img.thismedia.clicked").length?e.spiffy().enable():e.spiffy().disable(),t.hasClass("clicked")?(a=$(document.createElement("input")),a.attr("type","hidden"),a.attr("name","media"),a.val(t.data("media-name")),e.append(a)):e.find('input[type="hidden"]').each(function(){a=$(this),a.val()===t.data("media-name")&&a.remove()})}),$(document).on("click","[data-go]",function(){var e;e=$(this),go(e.data("go")+location.search)}),$(document).on("click","video",function(){var e;e=$(this),e.attr("data-clicked",!0),e[0].paused?(e[0].play(),e.parents("div.video:first").removeClass("paused")):(e[0].pause(),e.parents("div.video:first").addClass("paused"))}),adjustColumns(),$("div.input").each(function(){var e,t,a,n;e=$(this),t=e.find("input"),a=$(document.createElement("label")),a.html(t.attr("placeholder")),e.prepend(a),n=$(document.createElement("span")),n.addClass("bt-flabels__error-desc"),n.html(Spiffy.firstDefined(e.data("error-message"),"error")),e.append(n)})}),openModal=function(e){$('[data-modal-id="'+e+'"]').length&&($("[data-modal-id]").not('[data-modal-id="'+e+'"]').hide(0),$('[data-modal-id="'+e+'"]').show(0),$(".modal-overlay").show(0),$(".modal").slideDown(500))},closeModal=function(){$(".modal").slideUp(250,function(){return $("[data-modal-id]").hide(0),$(".modal-overlay").hide(0)})},fingerprint=function(){var e,t;return e=sessionStorage.getItem("fingerprint"),null!=e?e:(t={excludeAdBlock:!0,excludeAvailableScreenResolution:!0},new Fingerprint2(t).get(function(e){sessionStorage.setItem("fingerprint",e),$('input[name="fingerprint"]').each(function(){$(this).val(e)})}),null)},load=function(e){var t,a;loadPosts(e.posts),t=$("form.load-posts"),a=t.find('input[name="after"]'),a.val(e.next)},loadPosts=function(e){var t,a,n,i,o,s,d,r,l,u,c,f,p,m,h,v;for(s=l=0,p=e.length;p>=0?p>l:l>p;s=p>=0?++l:--l)f=e[s],c=$(document.createElement("div")),c.addClass("panel"),c.attr("data-post-id",f.postId),t=$(document.createElement("div")),t.addClass("centeryo"),o=$(document.createElement("div")),o.addClass("mediayo"),i=f.content,i.type.equalsIgnoreCase("video")?(o.addClass("video"),o.addClass("paused"),v=$(document.createElement("video")),v.attr("muted",!0),v.attr("loop",!0),v.attr("poster",i.poster.file),m=$(document.createElement("source")),m.attr("src",i.mp4),m.attr("type","video/mp4"),v.append(m),m=$(document.createElement("source")),m.attr("src",i.webm),m.attr("type","video/webm"),v.append(m),null!=i.gif&&(d=$(document.createElement("img")),d.attr("src",i.gif),v.append(d)),o.prepend(v)):i.type.equalsIgnoreCase("image")?(d=$(document.createElement("img")),d.attr("src",i.medium),o.prepend(d)):(h=Handlebars.compile($('[data-template="panel-ad"]').html()),o.append(h({}))),t.html(o),c.prepend(t),h=i.type.equalsIgnoreCase("ad")?Handlebars.compile($('[data-template="panel-ad-source"]').html()):Handlebars.compile($('[data-template="panel-source"]').html()),c.append(h({post:f})),n=3,$(window).width()<Width.xl&&(n=2),$(window).width()<Width.md&&(n=1),a=$('.col[data-index="'+s%n+'"]'),u=a.find(".panel:last"),r=null!=u&&u.is(".panel")?u.data("index")+n:a.data("index"),c.attr("data-index",r),a.append(c),i.type.equalsIgnoreCase("ad")&&(adsbygoogle=window.adsbygoogle||[]).push({})},adjustColumns=function(){var e,t,a,n;$(".col").each(function(e){var t;$(this).attr("data-index",e),t=e,$(this).find(".panel").each(function(e){$(this).attr("data-index",$(".col").length*e+t)})}),t=$("form.load-posts"),null!=t&&t.is("form.load-posts")&&(e=$('.col[data-index="2"]'),n=e.find(".panel:last"),a=t.find('input[name="after"]'),a.val(n.data("post-id"))),$(window).width()<Width.xl&&emptyColumn(2),$(window).width()<Width.md&&emptyColumn(1)},emptyColumn=function(e){var t,a;t=$('.col[data-index="'+e+'"]'),a=t.find(".panel"),a.length&&(a.each(function(){var t,a;a=$(this),t=a.data("index"),t=1===e||t%2===0?t-1:t-2,a.detach().insertAfter('.panel[data-index="'+t+'"]')}),sortColumn(1))},fillColumn=function(e,t){var a,n;a=$('.col[data-index="'+e+'"]'),n=a.find(".panel"),n.length||(a=$('.col[data-index!="'+e+'"]'),n=a.find(".panel"),n.each(function(){var a;a=$(this),a.data("index")%t===e&&a.detach().appendTo('.col[data-index="'+e+'"]')}),sortColumn(e))},sortColumn=function(e){var t,a,n;t=$('.col[data-index="'+e+'"]'),a=t.find(".panel"),n=a.sort(function(e,t){return $(e).data("index")-$(t).data("index")}),t.html(n)},$(window).resize(function(){var e;e=$(window).width(),e>window.pWidth&&e>=Width.md&&($(".subheader").show(),fillColumn(1,2)),e<window.pWidth&&e<Width.md&&($(".subheader").hide(),$(".hamburger").removeClass("active"),emptyColumn(1)),e>window.pWidth&&e>=Width.xl&&(emptyColumn(1),fillColumn(1,3),fillColumn(2,3)),e<window.pWidth&&e<Width.xl&&emptyColumn(2),window.pWidth=e}),$(window).scroll(function(){$("video").each(function(){var e,t,a;a=$(this),a.data("clicked")||(t=a[0].getBoundingClientRect().top,e=a.parents(".panel:first").find(".source"),75>t||!a.is(":in-viewport")||!e.is(":in-viewport")?a[0].paused||(a[0].pause(),a.parents("div.video:first").addClass("paused")):a[0].paused&&(a[0].play(),a[0].paused||a.parents("div.video:first").removeClass("paused")))})}),$(window).scroll(function(){var e,t,a,n,i;a=$("form.load-posts"),null!=a&&a.is("form.load-posts")&&(e=$('.col[data-index="0"]'),n=e.find(".panel:in-viewport:first"),n.data("post-id").equalsIgnoreCase("ad")||(t=e.find(".panel:first"),i=location.pathname,n.is(t)||(i=i+"?start="+n.data("post-id")),history.replaceState({},"SPIFFY.io",i)))}),$(window).scroll(function(){$(window).scrollTop()>400?($("div.header").addClass("hidden"),$("div.header").find(".sub-menu").removeClass("show")):$("div.header").removeClass("hidden"),$("div.col").each(function(){var e,t;e=$(this),t=e.find("div.panel:last"),null!=t&&t.is(":in-viewport")&&$("form.load-posts").submit()})}),$(window).on("beforeunload",function(){location.search.contains("start")&&$(window).scrollTop(0)}),function(e){"use strict";var t;t=function(t){var a;a=e(this),t&&e.each(e(".input input"),function(t,a){var n;n=e(a),n.val()&&n.closest(".input").addClass("bt-flabel__float")}),setTimeout(function(){a.val()?a.closest(".input").addClass("bt-flabel__float"):a.closest(".input").removeClass("bt-flabel__float")},1)},e(".input input").keydown(t),e(".input input").change(t),window.addEventListener("load",t(!0),!1),e("form").each(function(){var t;return t=e(this),t.find("input").length?(t.attr("data-parsley-errors-messages-disabled",""),t.parsley().on("form:error",function(){e.each(this.fields,function(e,t){var a,n;t.validationResult!==!0&&(n=t.validationResult[0].assert.name,n.equalsIgnoreCase("type")?n="invalid "+t.validationResult[0].assert.requirements:n.equalsIgnoreCase("equalto")&&(n="unmatched "+t.$element.parents("form:first").find(t.validationResult[0].assert.requirements).attr("placeholder")),a=t.$element.parent(),a.find("span").html(n),a.addClass("bt-flabels__error"))})}),t.parsley().on("field:validated",function(){var e;this.validationResult===!0?(e=this.$element.parent(),e.removeClass("bt-flabels__error")):(e=this.$element.parent(),e.addClass("bt-flabels__error"))})):void 0})}(jQuery);
