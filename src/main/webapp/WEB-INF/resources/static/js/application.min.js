var Config,Keys,Width;Config={cdn:"//cdn.spiffy.io/static"},Keys={left:37,right:39},Width={xs:320,sm:480,md:768,lg:992,xl:1200};var blank,confirmation,contains,defined,go,handler,high,initModalSize,medium,overrideHandler,preventDefault,quality,refresh;preventDefault=function(e){e.preventDefault()},overrideHandler=refresh,handler=function(e){return defined(e)&&(overrideHandler=e),defined(overrideHandler)?overrideHandler:refresh},medium=function(e){quality(e,"m",["a","l"],function(){high(e)})},high=function(e){quality(e,"h",["a","l","m"])},quality=function(e,n,t,a){var i,o,r,d,l;for(null==t&&(t=["a","l","m","h"]),l=e.attr("src"),i=0,r=t.length;r>i;i++)d=t[i],l=l.replace("q="+d,"q="+n);o=new Image,o.onload(function(){e.remove("lazy").attr("src",l),null!=a&&a()}),o.src=l},confirmation=function(e,n){var t;t=$("#confirmation"),t.find(".modal-title").text(e),t.find(".continue").on("click",function(e){return e.preventDefault(),n()}),t.modal("show")},go=function(e){return location.href=e},refresh=function(){return location.reload(!0),window.location=self.location},blank=function(e){return defined(e)?""===e:!0},defined=function(e){return"undefined"==typeof e?!1:"undefined"!==e},contains=function(e,n){var t;return t=e.indexOf(n),t>-1},initModalSize=function(){var e;return e=$(window).height()-125+"px",$(".modal-body").css("max-height",e),e};var Spiffy,base,base1,base2,base3,base4;null==(base=Array.prototype).isArray&&(base.isArray=function(){return"[object Array]"==={}.toString.call(value)}),null==(base1=String.prototype).startsWith&&(base1.startsWith=function(e){return this.slice(0,e.length)===e}),null==(base2=String.prototype).endsWith&&(base2.endsWith=function(e){return""===e||this.slice(-e.length)===e}),null==(base3=String.prototype).contains&&(base3.contains=function(e){return""===e||this.indexOf(e)>-1}),null==(base4=String.prototype).equalsIgnoreCase&&(base4.equalsIgnoreCase=function(e){return this.toUpperCase()===e.toUpperCase()}),Spiffy={firstDefined:function(){var e,n,t;for(t=arguments.length-1;t>=0;t+=-1)e=arguments[t],null!=e&&(n=e);return null!=n?n:void 0}},jQuery.fn.spiffy=function(){var e,n;return e=$(this),n={end:function(){return e},disable:function(){return e.find("form, input, textarea, select, button, div.g-recaptcha").addBack().prop("disabled",!0).attr("data-disabled",!0).addClass("disabled").data("disabled",!0),e.spiffy()},enable:function(){return e.find("form, input, textarea, select, button, div.g-recaptcha").addBack().removeAttr("disabled").removeAttr("data-disabled").removeClass("disabled").data("disabled",!1),e.spiffy()},clear:function(){return e.find("input, textarea").val(""),e.spiffy()},push:function(n){var t,a,i;return t=$(e[0]),a=t.attr("name"),i=t.val(),null==n[a]?n[a]=i:Array.isArray(n[a])?n[a].push(i):n[a]=[n[a],i],n},data:function(){var n,t,a,i;if(e.length>1){for(n=[],a=0,i=e.length;i>a;a++)t=e[a],n.push($(t).spiffy().data());return n}return t=$(e[0]),t.is("form")?(n={},t.find("[name]").each(function(){return $(this).spiffy().push(n)}),$('[data-form-name="'+t.data("name")+'"]').each(function(){return $(this).spiffy().push(n)}),n):n=t.val()},loading:function(n,t){var a,i,o,r;return null==t&&(t=!0),i=$(e[0]),i.is("form")?("overlay".equalsIgnoreCase(n)?(o=i.find("img.loading"),!t||null!=o&&o.is("img.loading")||(i.css("position","relative"),o=$(document.createElement("img")),o.addClass("loading"),o.attr("src","https://cdn.spiffy.io/static/svg/loading.svg"),o.prop("hidden"),i.append(o)),t&&null!=o&&o.is("img.loading")&&o.slideDown(),!t&&null!=o&&o.is("img.loading")&&o.slideUp()):"header".equalsIgnoreCase(n)&&(o=$("img.header-logo"),null!=o&&o.is("img.header-logo")&&(r=o.attr("src"),r=t?r.replace("icon","loading"):r.replace("loading","icon"),o.attr("src",r)),a=$("div.header-loading"),null!=a&&a.is("div.header-loading")&&(t?a.animate({width:"80%"},2e3):a.finish().animate({width:"100%"},250,"swing",function(){return a.animate({opacity:"0"},500,"swing",function(){return a.css("width","0%"),a.css("opacity","1")})}))),i.spiffy()):void 0},options:function(n){var t;return t=$(e[0]),t.is("form")?null!=n?(t.data("options",$.extend(t.data("options"),n)),t.spiffy()):t.data("options"):void 0},submit:function(n){var t,a,i,o,r,d,l;return o=$(e[0]),o.is("form")&&!o.data("disabled")?(n=Spiffy.firstDefined(n,$(o).spiffy().options(),{}),l=Spiffy.firstDefined(n.url,o.data("url"),o.attr("action")),d=Spiffy.firstDefined(n.type,o.data("type"),o.attr("method"),"POST"),t=o.data("csrf-token"),null==t&&d.equalsIgnoreCase("POST")&&alert("csrf required"),i=Spiffy.firstDefined(n.disable,!0),i&&o.spiffy().disable(),r=Spiffy.firstDefined(n.loading,o.data("loading"),"overlay"),o.spiffy().loading(r),a=o.spiffy().data(),$.ajax({url:l,data:a,dataType:"json",headers:{"X-CSRF-Token":t},type:d,success:function(e,t,a){return o.spiffy().enable().loading(r,!1),null!=n.success?n.success(o,e,t,a):void 0},error:function(e,t,a){var i,d,l,s;return l=e.responseJSON,401===e.status&&null!=l.uri?void go(e.responseJSON.uri):(400===e.status&&null!=l.error&&(d=o.find('input[name="'+l.error+'"]'),null!=d&&d.is('input[name="'+l.error+'"]')?(i=d.parent(),s=i.find("span"),i.addClass("bt-flabels__error"),s.html(l.reason)):(i=o.find("div.message"),i.addClass("error"),i.html(l.reason),i.slideDown())),o.spiffy().enable().loading(r,!1),null!=n.error?n.error(o,e,t,a):void 0)}}),o.spiffy()):void 0}}};var adjustColumns,closeModal,emptyColumn,fillColumn,fingerprint,load,loadPosts,openModal,sortColumn;Dropzone.options.dzForm={paramName:"file",maxFiles:1,maxFilesize:200,accept:function(e,n){n()},success:function(e,n){var t,a,i,o,r,d,l,s,f,u,c,p,m;for($("#dz-form").slideUp(),t=$("form.submit"),s=t.find("div.preview"),m=!1,f=n.types,i=0,r=f.length;r>i;i++)p=f[i],m=m||p.equalsIgnoreCase("MP4")||p.equalsIgnoreCase("WEBM");if(m){for(m=$(document.createElement("video")),m.attr("muted",!0),m.attr("loop",!0),u=n.types,o=0,d=u.length;d>o;o++)p=u[o],p.equalsIgnoreCase("MP4")?(c=$(document.createElement("source")),c.attr("src",n.url+p.toLowerCase()),c.attr("type","video/"+p.toLowerCase()),m.append(c)):(a=$(document.createElement("img")),a.attr("src",n.url+p.toLowerCase()),m.append(a));s.prepend(m)}else a=$(document.createElement("img")),a.attr("src",n.url+n.types[0].toLowerCase()),s.prepend(a);t.slideDown(),l=t.find('input[name="media"]'),l.val().length?l.val(l.val()+","+n.id):l.val(n.id)}},$(document).ready(function(){var e;$("div.header").mouseenter(function(){$(this).is(":hover")&&$(this).removeClass("hidden")}),$("div.header").mouseleave(function(){var e,n;n=$(this),e=function(){!n.is(":hover")&&$(window).scrollTop()>400&&n.addClass("hidden")},setTimeout(e,500)}),$("[data-modal]").click(function(){openModal($(this).data("modal"))}),$("[data-uri]").click(function(){go($(this).data("uri"))}),$(document).on("click","[data-post]",function(){}),$('input[name="fingerprint"]')&&(e=fingerprint(),null!=e&&$('input[name="fingerprint"]').each(function(){$(this).val(e)})),$("form:not(#dz-form)").submit(function(e){var n;preventDefault(e),n=$(this),n.spiffy().submit()}),$("form.load-posts").spiffy().options({success:function(e,n){return null==n.posts?e.spiffy().disable():load(n)}}),$("form[data-return-uri]").spiffy().options({success:function(e){return go(e.data("return-uri"))}}),$("form.submit").spiffy().options({success:function(){return go("/")}}),$("a[data-form]").click(function(e){var n;preventDefault(e),n=$("form."+$(this).data("form")),n.submit()}),$("a[data-session-id]").click(function(e){var n;preventDefault(e),n=$("form.logout"),n.find('input[name="session"]').val($(this).data("session-id")),n.submit()}),$("form.logout").spiffy().options({success:function(e){var n,t,a;t=e.find('input[name="session"]'),a=t.val(),n=$('[data-session-id="'+a+'"]'),n.parent().parent().slideUp()}}),$(".close").click(function(){closeModal()}),$(".modal-overlay").click(function(e){$(e.target).hasClass("modal-overlay")&&closeModal()}),$(document).on("click","video",function(){var e;e=$(this),e[0].paused?(e[0].play(),e.parents("div.video:first").removeClass("paused")):(e[0].pause(),e.parents("div.video:first").addClass("paused"))}),adjustColumns(),$("div.input").each(function(){var e,n,t,a;e=$(this),n=e.find("input"),t=$(document.createElement("label")),t.html(n.attr("placeholder")),e.prepend(t),a=$(document.createElement("span")),a.addClass("bt-flabels__error-desc"),a.html(Spiffy.firstDefined(e.data("error-message"),"error")),e.append(a)})}),openModal=function(e){$('[data-modal-id="'+e+'"]').length&&($("[data-modal-id]").not('[data-modal-id="'+e+'"]').hide(0),$('[data-modal-id="'+e+'"]').show(0),$(".modal-overlay").show(0),$(".modal").slideDown(500))},closeModal=function(){$(".modal").slideUp(250,function(){return $("[data-modal-id]").hide(0),$(".modal-overlay").hide(0)})},fingerprint=function(){var e,n;return e=sessionStorage.getItem("fingerprint"),null!=e?e:(n={excludeAdBlock:!0,excludeAvailableScreenResolution:!0},new Fingerprint2(n).get(function(e){sessionStorage.setItem("fingerprint",e),$('input[name="fingerprint"]').each(function(){$(this).val(e)})}),null)},load=function(e){var n;loadPosts(e.posts),n=$("form.load-posts").find('input[name="after"]').val(),$("form.load-posts").find('input[name="after"]').val(e.next),adjustColumns(),history.replaceState(e,"SPIFFY.io","/stream?start="+n)},loadPosts=function(e){var n,t,a,i,o,r,d,l,s,f,u,c,p,m,h,v,g;for(a=o=0,c=e.length;c>=0?c>o:o>c;a=c>=0?++o:--o){for(u=e[a],f=$(document.createElement("div")),f.addClass("panel"),f.attr("data-post",u.postId),g=!1,p=u.types,r=0,l=p.length;l>r;r++)v=p[r],g=g||v.equalsIgnoreCase("MP4")||v.equalsIgnoreCase("WEBM");if(g){for(f.addClass("video"),f.addClass("paused"),g=$(document.createElement("video")),g.attr("muted",!0),g.attr("loop",!0),g.attr("preload","none"),u.types[0].equalsIgnoreCase("PNG")&&g.attr("poster",u.url+u.types[0].toLowerCase()),m=u.types,d=0,s=m.length;s>d;d++)v=m[d],v.equalsIgnoreCase("MP4")?(h=$(document.createElement("source")),h.attr("src",u.url+v.toLowerCase()),h.attr("type","video/"+v.toLowerCase()),g.append(h)):v.equalsIgnoreCase("GIF")&&(i=$(document.createElement("img")),i.attr("data-src",u.url+v.toLowerCase()),g.append(i));f.prepend(g)}else i=$(document.createElement("img")),i.attr("src",u.url+u.types[0].toLowerCase()),f.prepend(i);t=$(document.createElement("div")),t.addClass("footer"),t.html(u.title),f.append(t),n=$('.col[data-index="'+a%3+'"]'),n.append(f)}},adjustColumns=function(){$(".col").each(function(e){var n;$(this).attr("data-index",e),n=e,$(this).find(".panel").each(function(e){$(this).attr("data-index",$(".col").length*e+n)})}),$(window).width()<Width.xl&&emptyColumn(2),$(window).width()<Width.md&&emptyColumn(1)},emptyColumn=function(e){var n,t;n=$('.col[data-index="'+e+'"]'),t=n.find(".panel"),t.length&&(t.each(function(){var n,t;t=$(this),n=t.data("index"),n=1===e||n%2===0?n-1:n-2,t.detach().insertAfter('.panel[data-index="'+n+'"]')}),sortColumn(1))},fillColumn=function(e){var n,t;n=$('.col[data-index="'+e+'"]'),t=n.find(".panel"),t.length||(n=$('.col[data-index!="'+e+'"]'),t=n.find(".panel"),t.each(function(){var n;n=$(this),n.data("index")%3===e&&n.detach().appendTo('.col[data-index="'+e+'"]')}),sortColumn(e))},sortColumn=function(e){var n,t,a;n=$('.col[data-index="'+e+'"]'),t=n.find(".panel"),a=t.sort(function(e,n){return $(e).data("index")-$(n).data("index")}),n.html(a)},$(window).resize(function(){var e;e=$(window).width(),e>window.pWidth&&e>=Width.md&&($(".subheader").show(),fillColumn(1)),e<window.pWidth&&e<Width.md&&($(".subheader").hide(),$(".hamburger").removeClass("active"),emptyColumn(1)),e>window.pWidth&&e>=Width.xl&&fillColumn(2),e<window.pWidth&&e<Width.xl&&emptyColumn(2),window.pWidth=e}),$(window).scroll(function(){$("video").each(function(){var e;e=$(this),e.is(":in-viewport")||(e[0].pause(),e.parents("div.video:first").addClass("paused"))})}),$(window).scroll(function(){$(window).scrollTop()>400?$("div.header").addClass("hidden"):$("div.header").removeClass("hidden"),$("div.col").each(function(){var e,n;e=$(this),n=e.find("div.panel:last"),null!=n&&n.is(":in-viewport")&&$("form.load-posts").submit()})}),$(window).on("beforeunload",function(){location.search.contains("start")&&$(window).scrollTop(0)}),function(e){"use strict";var n;n=function(n){var t;t=e(this),n&&e.each(e(".input input"),function(n,t){var a;a=e(t),a.val()&&a.closest(".input").addClass("bt-flabel__float")}),setTimeout(function(){t.val()?t.closest(".input").addClass("bt-flabel__float"):t.closest(".input").removeClass("bt-flabel__float")},1)},e(".input input").keydown(n),e(".input input").change(n),window.addEventListener("load",n(!0),!1),e("form").each(function(){var n;return n=e(this),n.find("input").length?(n.attr("data-parsley-errors-messages-disabled",""),n.parsley().on("form:error",function(){e.each(this.fields,function(e,n){var t,a;n.validationResult!==!0&&(a=n.validationResult[0].assert.name,a.equalsIgnoreCase("type")?a="invalid "+n.validationResult[0].assert.requirements:a.equalsIgnoreCase("equalto")&&(a="unmatched "+n.$element.parents("form:first").find(n.validationResult[0].assert.requirements).attr("placeholder")),t=n.$element.parent(),t.find("span").html(a),t.addClass("bt-flabels__error"))})}),n.parsley().on("field:validated",function(){var e;this.validationResult===!0?(e=this.$element.parent(),e.removeClass("bt-flabels__error")):(e=this.$element.parent(),e.addClass("bt-flabels__error"))})):void 0})}(jQuery);
