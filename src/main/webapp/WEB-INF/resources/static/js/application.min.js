var Config,Keys,Width;Config={cdn:"//cdn.spiffy.io/static"},Keys={left:37,right:39},Width={xs:320,sm:480,md:768,lg:992,xl:1200};var blank,confirmation,contains,defined,go,handler,high,initModalSize,medium,overrideHandler,preventDefault,quality,refresh;preventDefault=function(n){n.preventDefault()},overrideHandler=refresh,handler=function(n){return defined(n)&&(overrideHandler=n),defined(overrideHandler)?overrideHandler:refresh},medium=function(n){quality(n,"m",["a","l"],function(){high(n)})},high=function(n){quality(n,"h",["a","l","m"])},quality=function(n,t,e,i){var a,o,r,d,l;for(null==e&&(e=["a","l","m","h"]),l=n.attr("src"),a=0,r=e.length;r>a;a++)d=e[a],l=l.replace("q="+d,"q="+t);o=new Image,o.onload(function(){n.remove("lazy").attr("src",l),null!=i&&i()}),o.src=l},confirmation=function(n,t){var e;e=$("#confirmation"),e.find(".modal-title").text(n),e.find(".continue").on("click",function(n){return n.preventDefault(),t()}),e.modal("show")},go=function(n){return location.href=n},refresh=function(){return location.reload(!0),window.location=self.location},blank=function(n){return defined(n)?""===n:!0},defined=function(n){return"undefined"==typeof n?!1:"undefined"!==n},contains=function(n,t){var e;return e=n.indexOf(t),e>-1},initModalSize=function(){var n;return n=$(window).height()-125+"px",$(".modal-body").css("max-height",n),n};var Spiffy,base,base1,base2,base3,base4;null==(base=Array.prototype).isArray&&(base.isArray=function(){return"[object Array]"==={}.toString.call(value)}),null==(base1=String.prototype).startsWith&&(base1.startsWith=function(n){return this.slice(0,n.length)===n}),null==(base2=String.prototype).endsWith&&(base2.endsWith=function(n){return""===n||this.slice(-n.length)===n}),null==(base3=String.prototype).contains&&(base3.contains=function(n){return""===n||this.indexOf(n)>-1}),null==(base4=String.prototype).equalsIgnoreCase&&(base4.equalsIgnoreCase=function(n){return this.toUpperCase()===n.toUpperCase()}),Spiffy={firstDefined:function(){var n,t,e;for(e=arguments.length-1;e>=0;e+=-1)n=arguments[e],null!=n&&(t=n);return null!=t?t:void 0}},jQuery.fn.spiffy=function(){var n,t;return n=$(this),t={end:function(){return n},disable:function(){return n.find("form, input, textarea, select, button, div.g-recaptcha").addBack().prop("disabled",!0).attr("data-disabled",!0).addClass("disabled").data("disabled",!0),n.spiffy()},enable:function(){return n.find("form, input, textarea, select, button, div.g-recaptcha").addBack().removeAttr("disabled").removeAttr("data-disabled").removeClass("disabled").data("disabled",!1),n.spiffy()},clear:function(){return n.find("input, textarea").val(""),n.spiffy()},push:function(t){var e,i,a;return e=$(n[0]),i=e.attr("name"),a=e.val(),null==t[i]?t[i]=a:Array.isArray(t[i])?t[i].push(a):t[i]=[t[i],a],t},data:function(){var t,e,i,a;if(n.length>1){for(t=[],i=0,a=n.length;a>i;i++)e=n[i],t.push($(e).spiffy().data());return t}return e=$(n[0]),e.is("form")?(t={},e.find("[name]").each(function(){return $(this).spiffy().push(t)}),$('[data-form-name="'+e.data("name")+'"]').each(function(){return $(this).spiffy().push(t)}),t):t=e.val()},loading:function(t,e){var i,a,o,r;return null==e&&(e=!0),a=$(n[0]),a.is("form")?("overlay".equalsIgnoreCase(t)?(o=a.find("img.loading"),!e||null!=o&&o.is("img.loading")||(a.css("position","relative"),o=$(document.createElement("img")),o.addClass("loading"),o.attr("src","https://cdn.spiffy.io/static/svg/loading.svg"),o.prop("hidden"),a.append(o)),e&&null!=o&&o.is("img.loading")&&o.slideDown(),!e&&null!=o&&o.is("img.loading")&&o.slideUp()):"header".equalsIgnoreCase(t)&&(o=$("img.header-logo"),null!=o&&o.is("img.header-logo")&&(r=o.attr("src"),r=e?r.replace("icon","loading"):r.replace("loading","icon"),o.attr("src",r)),i=$("div.header-loading"),null!=i&&i.is("div.header-loading")&&(e?i.animate({width:"80%"},2e3):i.finish().animate({width:"100%"},250,"swing",function(){return i.animate({opacity:"0"},500,"swing",function(){return i.css("width","0%"),i.css("opacity","1")})}))),a.spiffy()):void 0},options:function(t){var e;return e=$(n[0]),e.is("form")?null!=t?(e.data("options",$.extend(e.data("options"),t)),e.spiffy()):e.data("options"):void 0},submit:function(t){var e,i,a,o,r,d,l;return o=$(n[0]),o.is("form")&&!o.data("disabled")?(t=Spiffy.firstDefined(t,$(o).spiffy().options(),{}),l=Spiffy.firstDefined(t.url,o.data("url"),o.attr("action")),d=Spiffy.firstDefined(t.type,o.data("type"),o.attr("method"),"POST"),e=o.data("csrf-token"),null==e&&d.equalsIgnoreCase("POST")&&alert("csrf required"),a=Spiffy.firstDefined(t.disable,!0),a&&o.spiffy().disable(),r=Spiffy.firstDefined(t.loading,o.data("loading"),"overlay"),o.spiffy().loading(r),i=o.spiffy().data(),$.ajax({url:l,data:i,dataType:"json",headers:{"X-CSRF-Token":e},type:d,success:function(n,e,i){return o.spiffy().enable().loading(r,!1),null!=t.success?t.success(o,n,e,i):void 0},error:function(n,e,i){var a,d,l,s;return l=n.responseJSON,401===n.status&&null!=l.uri?void go(n.responseJSON.uri):(400===n.status&&null!=l.error&&(d=o.find('input[name="'+l.error+'"]'),null!=d&&d.is('input[name="'+l.error+'"]')?(a=d.parent(),s=a.find("span"),a.addClass("bt-flabels__error"),s.html(l.reason)):(a=o.find("div.message"),a.addClass("error"),a.html(l.reason),a.slideDown())),o.spiffy().enable().loading(r,!1),null!=t.error?t.error(o,n,e,i):void 0)}}),o.spiffy()):void 0}}};var adjustColumns,closeModal,emptyColumn,fillColumn,fingerprint,load,loadPosts,openModal,sortColumn;Dropzone.options.dzForm={paramName:"file",maxFiles:1,maxFilesize:200,accept:function(n,t){t()},success:function(n,t){var e;$("#dz-form").slideUp(),$("form.submit").slideDown().find("img").attr("src",t.url),e=$("form.submit").find('input[name="media"]'),e.val().length?e.val(e.val()+","+t.id):e.val(t.id)}},$(document).ready(function(){var n;$("div.header").mouseenter(function(){$(this).is(":hover")&&$(this).removeClass("hidden")}),$("div.header").mouseleave(function(){var n,t;t=$(this),n=function(){!t.is(":hover")&&$(window).scrollTop()>400&&t.addClass("hidden")},setTimeout(n,500)}),$("[data-modal]").click(function(){openModal($(this).data("modal"))}),$("[data-uri]").click(function(){go($(this).data("uri"))}),$("[data-post]").click(function(){go("/stream/"+$(this).data("post"))}),$('input[name="fingerprint"]')&&(n=fingerprint(),null!=n&&$('input[name="fingerprint"]').each(function(){$(this).val(n)})),$("form:not(#dz-form)").submit(function(n){var t;preventDefault(n),t=$(this),t.spiffy().submit()}),$("form.load-posts").spiffy().options({success:function(n,t){return null==t.posts?n.spiffy().disable():load(t)}}),$("form[data-return-uri]").spiffy().options({success:function(n){return go(n.data("return-uri"))}}),$("form.submit").spiffy().options({success:function(){return go("/")}}),$("a[data-form]").click(function(n){var t;preventDefault(n),t=$("form."+$(this).data("form")),t.submit()}),$("a[data-session-id]").click(function(n){var t;preventDefault(n),t=$("form.logout"),t.find('input[name="session"]').val($(this).data("session-id")),t.submit()}),$("form.logout").spiffy().options({success:function(n){var t,e,i;e=n.find('input[name="session"]'),i=e.val(),t=$('[data-session-id="'+i+'"]'),t.parent().parent().slideUp()}}),$(".close").click(function(){closeModal()}),$(".modal-overlay").click(function(n){$(n.target).hasClass("modal-overlay")&&closeModal()}),adjustColumns(),$("div.input").each(function(){var n,t,e,i;n=$(this),t=n.find("input"),e=$(document.createElement("label")),e.html(t.attr("placeholder")),n.prepend(e),i=$(document.createElement("span")),i.addClass("bt-flabels__error-desc"),i.html(Spiffy.firstDefined(n.data("error-message"),"error")),n.append(i)})}),openModal=function(n){$('[data-modal-id="'+n+'"]').length&&($("[data-modal-id]").not('[data-modal-id="'+n+'"]').hide(0),$('[data-modal-id="'+n+'"]').show(0),$(".modal-overlay").show(0),$(".modal").slideDown(500))},closeModal=function(){$(".modal").slideUp(250,function(){return $("[data-modal-id]").hide(0),$(".modal-overlay").hide(0)})},fingerprint=function(){var n,t;return n=sessionStorage.getItem("fingerprint"),null!=n?n:(t={excludeAdBlock:!0,excludeAvailableScreenResolution:!0},new Fingerprint2(t).get(function(n){sessionStorage.setItem("fingerprint",n),$('input[name="fingerprint"]').each(function(){$(this).val(n)})}),null)},load=function(n){var t;loadPosts(n.posts),$("[data-post]").click(function(){go("/stream/"+$(this).data("post"))}),t=$("form.load-posts").find('input[name="after"]').val(),$("form.load-posts").find('input[name="after"]').val(n.next),adjustColumns(),history.replaceState(n,"SPIFFY.io","/stream?start="+t)},loadPosts=function(n){var t,e,i,a,o,r,d,l;for(i=o=0,l=n.length;l>=0?l>o:o>l;i=l>=0?++o:--o)d=n[i],r=$(document.createElement("div")),r.addClass("panel"),r.attr("data-post",d.postId),a=$(document.createElement("img")),a.attr("src",d.url),r.append(a),e=$(document.createElement("div")),e.addClass("footer"),e.html(d.title),r.append(e),t=$('.col[data-index="'+i%3+'"]'),t.append(r)},adjustColumns=function(){$(".col").each(function(n){var t;$(this).attr("data-index",n),t=n,$(this).find(".panel").each(function(n){$(this).attr("data-index",$(".col").length*n+t)})}),$(window).width()<Width.xl&&emptyColumn(2),$(window).width()<Width.md&&emptyColumn(1)},emptyColumn=function(n){var t,e;t=$('.col[data-index="'+n+'"]'),e=t.find(".panel"),e.length&&(e.each(function(){var t,e;e=$(this),t=e.data("index"),t=1===n||t%2===0?t-1:t-2,e.detach().insertAfter('.panel[data-index="'+t+'"]')}),sortColumn(1))},fillColumn=function(n){var t,e;t=$('.col[data-index="'+n+'"]'),e=t.find(".panel"),e.length||(t=$('.col[data-index!="'+n+'"]'),e=t.find(".panel"),e.each(function(){var t;t=$(this),t.data("index")%3===n&&t.detach().appendTo('.col[data-index="'+n+'"]')}),sortColumn(n))},sortColumn=function(n){var t,e,i;t=$('.col[data-index="'+n+'"]'),e=t.find(".panel"),i=e.sort(function(n,t){return $(n).data("index")-$(t).data("index")}),t.html(i)},$(window).resize(function(){var n;n=$(window).width(),n>window.pWidth&&n>=Width.md&&($(".subheader").show(),fillColumn(1)),n<window.pWidth&&n<Width.md&&($(".subheader").hide(),$(".hamburger").removeClass("active"),emptyColumn(1)),n>window.pWidth&&n>=Width.xl&&fillColumn(2),n<window.pWidth&&n<Width.xl&&emptyColumn(2),window.pWidth=n}),$(window).scroll(function(){$(window).scrollTop()>400?$("div.header").addClass("hidden"):$("div.header").removeClass("hidden"),$("div.col").each(function(){var n,t;n=$(this),t=n.find("div.panel:last"),null!=t&&null!=t.offset()&&t.offset().top-t.height()<$(window).scrollTop()&&$("form.load-posts").submit()})}),$(window).on("beforeunload",function(){location.search.contains("start")&&$(window).scrollTop(0)}),function(n){"use strict";var t;t=function(t){var e;e=n(this),t&&n.each(n(".input input"),function(t,e){var i;i=n(e),i.val()&&i.closest(".input").addClass("bt-flabel__float")}),setTimeout(function(){e.val()?e.closest(".input").addClass("bt-flabel__float"):e.closest(".input").removeClass("bt-flabel__float")},1)},n(".input input").keydown(t),n(".input input").change(t),window.addEventListener("load",t(!0),!1),n("form").each(function(){var t;return t=n(this),t.find("input").length?(t.attr("data-parsley-errors-messages-disabled",""),t.parsley().on("form:error",function(){n.each(this.fields,function(n,t){var e,i;t.validationResult!==!0&&(i=t.validationResult[0].assert.name,i.equalsIgnoreCase("type")?i="invalid "+t.validationResult[0].assert.requirements:i.equalsIgnoreCase("equalto")&&(i="unmatched "+t.$element.parents("form:first").find(t.validationResult[0].assert.requirements).attr("placeholder")),e=t.$element.parent(),e.find("span").html(i),e.addClass("bt-flabels__error"))})}),t.parsley().on("field:validated",function(){var n;this.validationResult===!0?(n=this.$element.parent(),n.removeClass("bt-flabels__error")):(n=this.$element.parent(),n.addClass("bt-flabels__error"))})):void 0})}(jQuery);
