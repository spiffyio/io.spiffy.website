var Config,Keys,Width;Config={cdn:"//cdn.spiffy.io/static"},Keys={left:37,right:39},Width={xs:320,sm:480,md:768,lg:992,xl:1200};var blank,confirmation,contains,defined,go,handler,high,initModalSize,medium,overrideHandler,preventDefault,quality,recaptchaCallback,refresh;recaptchaCallback=function(){$(".g-recaptcha").each(function(n,t){grecaptcha.render(t,{sitekey:"6LeSviITAAAAAFC9aCd6CAmWFqLoIpzw174jMc-i"})})},preventDefault=function(n){n.preventDefault()},overrideHandler=refresh,handler=function(n){return defined(n)&&(overrideHandler=n),defined(overrideHandler)?overrideHandler:refresh},medium=function(n){quality(n,"m",["a","l"],function(){high(n)})},high=function(n){quality(n,"h",["a","l","m"])},quality=function(n,t,e,i){var a,o,r,d,l;for(null==e&&(e=["a","l","m","h"]),l=n.attr("src"),o=0,r=e.length;r>o;o++)d=e[o],l=l.replace("q="+d,"q="+t);a=new Image,a.onload(function(){n.remove("lazy").attr("src",l),null!=i&&i()}),a.src=l},confirmation=function(n,t){var e;e=$("#confirmation"),e.find(".modal-title").text(n),e.find(".continue").on("click",function(n){return n.preventDefault(),t()}),e.modal("show")},go=function(n){return location.href=n},refresh=function(){return location.reload(!0),window.location=self.location},blank=function(n){return defined(n)?""===n:!0},defined=function(n){return"undefined"==typeof n?!1:"undefined"!==n},contains=function(n,t){var e;return e=n.indexOf(t),e>-1},initModalSize=function(){var n;return n=$(window).height()-125+"px",$(".modal-body").css("max-height",n),n};var base,base1,base2;null==(base=String.prototype).startsWith&&(base.startsWith=function(n){return this.slice(0,n.length)===n}),null==(base1=String.prototype).endsWith&&(base1.endsWith=function(n){return""===n||this.slice(-n.length)===n}),null==(base2=String.prototype).contains&&(base2.contains=function(n){return""===n||this.indexOf(n)>-1}),jQuery.fn.spiffy=function(){var n,t;return n=$(this[0]),t={end:function(){return n},disable:function(){return n.find("form, input, textarea, select, button").addBack().prop("disabled",!0).attr("data-disabled",!0),n.spiffy()},enable:function(){return n.find("form, input, textarea, select, button").addBack().removeAttr("disabled").removeAttr("data-disabled"),n.spiffy()},clear:function(){return n.find("input, textarea").val(""),n.spiffy()}}},jQuery.fn.spiffyDisable=function(n){var t,e,i,a,o;for(null==n&&(n=!0),t=$(this[0]),t.data("disabled",n),o=["input","textarea","select","button"],e=0,a=o.length;a>e;e++)i=o[e],t.find(i).prop("disabled",n);return t},jQuery.fn.spiffyEnable=function(){var n;return n=$(this[0]),n.spiffyDisable(!1)},jQuery.fn.spiffyClear=function(){var n,t,e,i,a;for(n=$(this[0]),a=["input","textarea"],t=0,i=a.length;i>t;t++)e=a[t],n.find(e).val("");return n},jQuery.fn.spiffyValue=function(){var n,t,e,i,a;for(n=$(this[0]),i=["accept","decline","follow","unfollow","friend","unfriend","settings","like","hate","favorite","download","report"],t=0,e=i.length;e>t;t++)if(a=i[t],n.hasClass(a))return a},jQuery.fn.spiffyFormValue=function(n){var t,e,i;return e=$(this[0]),t=e.find("[name="+n+"]")[0],null==t&&(t=$("[data-form="+e.data("form")+"][name="+n+"]")[0]),null!=t?i=$(t).val():void 0},jQuery.fn.spiffyFormData=function(n){var t,e,i,a,o;for(e=$(this[0]),t={},i=0,a=n.length;a>i;i++)o=n[i],t[o]=e.spiffyFormValue(o);return t},jQuery.fn.spiffySubmit=function(n,t,e,i){var a,o,r,d,l,s;o=$(this[0]),o.data("disabled")!==!0&&(s=o.validate(),s.numberOfInvalids()||(a=defined(n.disable)?n.disable:!0,a&&o.spiffyDisable(),defined(n.loading)&&"header"===n.loading?(r=$("img.header-logo"),r.attr("src",r.attr("src").replace("icon","loading"))):(0===o.find("img.loading").length&&(o.css("position","relative"),o.append('<img class="loading" src="https://cdn.spiffy.io/static/svg/loading.svg" style="position:absolute;left:0;top:0;right:0;bottom:0;margin:auto;max-width:100%;max-height:100%;z-index:1000;" hidden="true"/>')),o.find("img.loading").slideDown()),l=defined(n.url)?n.url:n,d=defined(n.method)?n.method:"POST",$.ajax({url:l,data:t,dataType:"json",headers:{"X-CSRF-Token":o.data("csrf-token")},type:d,success:function(t){e(t),defined(n.loading)&&"header"===n.loading?(r=$("img.header-logo"),r.attr("src",r.attr("src").replace("loading","icon"))):o.find("img.loading").hide(250),a&&o.spiffyEnable(),s.resetForm()},error:function(t){var e;return defined(n.loading)&&"header"===n.loading?(r=$("img.header-logo"),r.attr("src",r.attr("src").replace("loading","icon"))):o.find("img.loading").hide(250),a&&o.spiffyEnable,401===t.status?(handler(function(n){$(".modal").modal("hide"),$("meta[name='csrf-header']").attr("content",n.csrf.header),$("meta[name='csrf-token']").attr("content",n.csrf.token),o.submit()}),void $("#signin").modal("show")):(e=t.responseJSON,e.error&&(0===o.find('input[name="error"]').length&&o.append('<input name="error" hidden="true">'),s.showErrors({error:e.error})),void(defined(i)&&i(s,e)))}})))};var adjustColumns,closeModal,emptyColumn,fillColumn,fingerprint,load,loadPosts,openModal,sortColumn;Dropzone.options.dzForm={paramName:"file",maxFiles:1,maxFilesize:20,accept:function(n,t){t()},success:function(n,t){var e;e=$("form.submit").find('input[name="media"]'),e.val().length?e.val(e.val()+","+t.id):e.val(t.id)}},$(document).ready(function(){var n;$("div.header").mouseenter(function(){$(this).is(":hover")&&$(this).removeClass("hidden")}),$("div.header").mouseleave(function(){var n,t;t=$(this),n=function(){!t.is(":hover")&&$(window).scrollTop()>400&&t.addClass("hidden")},setTimeout(n,500)}),$("[data-modal]").click(function(){openModal($(this).data("modal"))}),$("[data-uri]").click(function(){go($(this).data("uri"))}),$("[data-post]").click(function(){go("/stream/"+$(this).data("post"))}),$('input[name="fingerprint"]')&&(n=fingerprint(),null!=n&&$('input[name="fingerprint"]').each(function(){$(this).val(n)})),$("form.load-posts").submit(function(n){var t;preventDefault(n),t=$(this),t.spiffySubmit({url:"/posts",loading:"header"},$(this).spiffyFormData(["after","quantity"]),load)}),$("a[data-form]").click(function(n){var t;preventDefault(n),t=$("form."+$(this).data("form")),t.submit()}),$("form.email").submit(function(n){var t;preventDefault(n),t=$(this),t.spiffySubmit({url:"/account/verify",loading:"header"},{},refresh)}),$("a[data-session-id]").click(function(n){var t;preventDefault(n),t=$("form.logout"),t.find('input[name="session"]').val($(this).data("session-id")),t.submit()}),$("form.logout").submit(function(n){var t;preventDefault(n),t=$(this),t.spiffySubmit("/logout",$(this).spiffyFormData(["session"]),refresh)}),$("form.login").submit(function(n){var t;preventDefault(n),t=$(this),t.spiffySubmit("/login",$(this).spiffyFormData(["email","password","fingerprint","g-recaptcha-response"]),function(){return go(t.data("returnUri"))})}),$("form.register").submit(function(n){var t;preventDefault(n),t=$(this),t.spiffySubmit("/register",$(this).spiffyFormData(["username","email","password","fingerprint","g-recaptcha-response"]),function(){return go(t.data("returnUri"))})}),$("form.submit").submit(function(n){var t;preventDefault(n),t=$(this),t.spiffySubmit("/submit",$(this).spiffyFormData(["media","title","description","idempotentId"]),function(){return go("/")})}),$(".close").click(function(){closeModal()}),$(".modal-overlay").click(function(n){$(n.target).hasClass("modal-overlay")&&closeModal()}),adjustColumns()}),openModal=function(n){$('[data-modal-id="'+n+'"]').length&&($("[data-modal-id]").not('[data-modal-id="'+n+'"]').hide(0),$('[data-modal-id="'+n+'"]').show(0),$(".modal-overlay").show(0),$(".modal").slideDown(500))},closeModal=function(){$(".modal").slideUp(250,function(){return $("[data-modal-id]").hide(0),$(".modal-overlay").hide(0)})},fingerprint=function(){var n,t;return n=sessionStorage.getItem("fingerprint"),null!=n?n:(t={excludeAdBlock:!0,excludeAvailableScreenResolution:!0},new Fingerprint2(t).get(function(n){sessionStorage.setItem("fingerprint",n),$('input[name="fingerprint"]').each(function(){$(this).val(n)})}),null)},load=function(n){var t;loadPosts(n.posts),$("[data-post]").click(function(){go("/stream/"+$(this).data("post"))}),t=$("form.load-posts").find('input[name="after"]').val(),$("form.load-posts").find('input[name="after"]').val(n.next),adjustColumns(),history.replaceState(n,"SPIFFY.io","/stream?start="+t)},loadPosts=function(n){var t,e,i,a,o,r,d,l;for(i=o=0,l=n.length;l>=0?l>o:o>l;i=l>=0?++o:--o)d=n[i],r=$(document.createElement("div")),r.addClass("panel"),r.attr("data-post",d.postId),a=$(document.createElement("img")),a.attr("src",d.url),r.append(a),e=$(document.createElement("div")),e.addClass("footer"),e.html(d.title),r.append(e),t=$('.col[data-index="'+i%3+'"]'),t.append(r)},adjustColumns=function(){$(".col").each(function(n){var t;$(this).attr("data-index",n),t=n,$(this).find(".panel").each(function(n){$(this).attr("data-index",$(".col").length*n+t)})}),$(window).width()<Width.xl&&emptyColumn(2),$(window).width()<Width.md&&emptyColumn(1)},emptyColumn=function(n){var t,e;t=$('.col[data-index="'+n+'"]'),e=t.find(".panel"),e.length&&(e.each(function(){var t,e;e=$(this),t=e.data("index"),t=1===n||t%2===0?t-1:t-2,e.detach().insertAfter('.panel[data-index="'+t+'"]')}),sortColumn(1))},fillColumn=function(n){var t,e;t=$('.col[data-index="'+n+'"]'),e=t.find(".panel"),e.length||(t=$('.col[data-index!="'+n+'"]'),e=t.find(".panel"),e.each(function(){var t;t=$(this),t.data("index")%3===n&&t.detach().appendTo('.col[data-index="'+n+'"]')}),sortColumn(n))},sortColumn=function(n){var t,e,i;t=$('.col[data-index="'+n+'"]'),e=t.find(".panel"),i=e.sort(function(n,t){return $(n).data("index")-$(t).data("index")}),t.html(i)},$(window).resize(function(){var n;n=$(window).width(),n>window.pWidth&&n>=Width.md&&($(".subheader").show(),fillColumn(1)),n<window.pWidth&&n<Width.md&&($(".subheader").hide(),$(".hamburger").removeClass("active"),emptyColumn(1)),n>window.pWidth&&n>=Width.xl&&fillColumn(2),n<window.pWidth&&n<Width.xl&&emptyColumn(2),window.pWidth=n}),$(window).scroll(function(){$(window).scrollTop()>400?$("div.header").addClass("hidden"):$("div.header").removeClass("hidden"),$("div.col").each(function(){var n,t;n=$(this),t=n.find("div.panel:last"),null!=t&&null!=t.offset()&&t.offset().top-t.height()<$(window).scrollTop()&&$("form.load-posts").submit()})}),$(window).on("beforeunload",function(){location.search.contains("start")&&$(window).scrollTop(0)});
